<div class="records-export container">
  <div class="row">
    <div class="col-lg-6 col-xl-5 instructions">
      <h1 class="mb-3">Access your medical records</h1>
      <p>Experience the power of the Fasten Connect platform and pull your own medical records in just a few steps.</p>
      <ol>
        <li>Click the <strong>Export Records</strong> button to begin, and search for your healthcare provider.</li>
        <li>Choose your patient portal, then sign in with your existing credentials when prompted.</li>
        <li>Click <strong>Continue</strong> and <strong>Close</strong></li>
        <li>Once you return, Fasten will attempt to collect your records from your healthcare provider</li>
        <li>On success, you can view & download your records in FHIR format.</li>
      </ol>
      <div class="alert alert-warning mt-4" role="alert">
        <h6 class="mb-2">Demo Limitations</h6>
        <ul class="mb-0">
          <li>This demo is essentially stateless & your data is only cached for 24h.</li>
          <li>Refreshing the page will require re-authentication with your provider.</li>
          <li>You can only export one provider at a time; repeat the process for additional providers.</li>
          <li>Exports can take 5+ minutes if you have a long medical history.</li>
          <li>Some sources may not be working correctly.</li>
          <li>Exports larger than 10MB may fail or slow down your browser. Contact us if you need help retrieving a large payload.</li>
        </ul>
        <small class="pt-4 text-muted">These limitations only exist in this stateless demo environment, your actual integration will not have these limitations</small>
      </div>
      <p class="mt-4 text-muted">
        Need help or found a missing provider? <a href="mailto:support@fastenhealth.com" target="_blank" rel="noopener">Let us know</a> so we can investigate.
      </p>
    </div>
    <div class="col-lg-6 col-xl-7 widget-column">
      <div class="widget-card">

        <div *ngIf="hasError" class="d-flex justify-content-center mg-t-40">
          <div>
            <h1>Sorry, an error occurred.</h1>
            <p>We're working on fixing it now.</p>
            <p>Need more help? Send an email to <a href="mailto:support@fastenhealth.com">support@fastenhealth.com</a> and include the information below:</p>
            <div class="error-details">
            <pre><code>{{ errorMsg }}</code></pre>
            </div>


            <a class="btn btn-indigo btn-rounded" [routerLink]="'/records/export/'">Try Again</a>
          </div>
        </div>

        <div *ngIf="loading" class="d-flex justify-content-center mg-t-40">
          <div>
            <h1>Loading...</h1>
            <div role="status" class="spinner-border text-primary"><span class="sr-only">Loading...</span></div>
            <p>Please wait while we process your records.</p>
            <small class="tx-gray-400">started: {{bundleSyncStart}} <br/>last checked: {{bundleSyncCurrent}}</small>
          </div>

        </div>


        <div *ngIf="hasBundle">
          <div>
            <a [href]="generateBundleDownloadUrl" [download]="generateBundleDownloadFilename" class="btn btn-indigo btn-rounded">Download FHIR JSON File</a>
            <a class="btn btn-outline-indigo btn-rounded" [routerLink]="'/records/export/'">Connect Another Health System</a>

            <div class="mg-t-40">
              <pre style="max-height:600px; overflow-x: auto; max-width: 580px">
                <code [languages]="['json', 'xml']" [highlight]="bundle"></code>
              </pre>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
